(()=>{"use strict";var e={514:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(31);r(o(818)).default.config();const n=process.env.RENDER_DATABASE||"",i=process.env.RENDER_USERNAME||"",a=process.env.RENDER_PASSWORD||"",u=process.env.RENDER_HOST||"",d=parseInt(process.env.RENDER_PORT)||1234,l=new s.Sequelize(n,i,a,{host:u,port:d,dialect:"postgres",dialectOptions:{ssl:{require:!0,rejectUnauthorized:!1}}});t.default=l},529:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,n){function i(e){try{u(r.next(e))}catch(e){n(e)}}function a(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(o(278)),i=o(714),a=s(o(904)),u={jwtFromRequest:i.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:process.env.JWT_SECRET||"tu_secreto_aqui"};n.default.use(new i.Strategy(u,((e,t)=>r(void 0,void 0,void 0,(function*(){try{const o=yield a.default.findByPk(e.id);return t(null,o||!1)}catch(e){return t(e,!1)}}))))),t.default=n.default},259:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(o(450)),n=r(o(320)),i=(0,s.default)({definition:{openapi:"3.0.0",info:{title:"API de Usuarios",version:"1.0.0",description:"Documentación de la API de Usuarios"},servers:[{url:"http://localhost:3000",description:"Servidor de desarrollo"}],components:{securitySchemes:{bearerAuth:{type:"http",scheme:"bearer"}}}},apis:["./src/controllers/usuarios/usuarios.ts","./src/routes/usuarios/usuarios.ts","./src/models/usuarios/usuarios.ts"]});t.default=e=>{e.use("/api-docs",n.default.serve,n.default.setup(i))}},559:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,n){function i(e){try{u(r.next(e))}catch(e){n(e)}}function a(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.obtenerPing=void 0;const n=s(o(567)),i=o(574);t.obtenerPing=(e,t)=>r(void 0,void 0,void 0,(function*(){try{return void t.status(200).json({status:200,message:"pong"})}catch(e){(0,n.default)({metodo:i.tiposDeMetodos.GET,error:e,res:t})}}))},409:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,n){function i(e){try{u(r.next(e))}catch(e){n(e)}}function a(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.eliminarUsuario=t.modificarUsuario=t.crearUsuario=t.obtenerUsuarios=void 0;const n=s(o(904)),i=s(o(567)),a=o(574),u=o(577);t.obtenerUsuarios=(e,t,o)=>r(void 0,void 0,void 0,(function*(){const{nombre:r}=e.query;try{const e=yield n.default.findAll();yield(0,u.logMessageToSentryAndDb)("primer log");const s=r?e.filter((e=>e.nombre===r)):e;if("json"===o)return void t.status(200).json(s);if("texto"===o)return void t.status(200).send(JSON.stringify(s));const i=`\n        <html>\n        ${s.map((e=>e))}\n        </html>\n      `;t.status(200).send(i)}catch(e){(0,i.default)({metodo:a.tiposDeMetodos.GET,error:e,res:t})}})),t.crearUsuario=(e,t)=>r(void 0,void 0,void 0,(function*(){const{nombre:o,apellido:r}=e.body;if(o&&r)try{const e=yield n.default.create({nombre:o,apellido:r});t.status(201).json(e)}catch(e){(0,i.default)({metodo:a.tiposDeMetodos.POST,error:e,res:t})}else{const e=new Error("No contiene nombre o apellido en el cuerpo");(0,i.default)({metodo:a.tiposDeMetodos.POST,error:e,res:t})}})),t.modificarUsuario=(e,t)=>r(void 0,void 0,void 0,(function*(){const{id:o}=e.params,{nombre:r,apellido:s}=e.body;if(r&&s)try{const e=yield n.default.findByPk(o);if(!e){const e=new Error("Usuario no encontrado");return void(0,i.default)({metodo:a.tiposDeMetodos.PUT,error:e,res:t})}const u=yield e.update({nombre:r,apellido:s});t.status(200).json(u)}catch(e){(0,i.default)({metodo:a.tiposDeMetodos.PUT,error:e,res:t})}else{const e=new Error("No contiene nombre o apellido en el cuerpo");(0,i.default)({metodo:a.tiposDeMetodos.PUT,error:e,res:t})}})),t.eliminarUsuario=(e,t)=>r(void 0,void 0,void 0,(function*(){const{id:o}=e.params;try{const e=yield n.default.findByPk(o);if(!e){const e=new Error("Usuario no encontrado");return void(0,i.default)({metodo:a.tiposDeMetodos.DELETE,error:e,res:t})}yield e.destroy(),t.status(200).json({message:"Usuario eliminado exitosamente"})}catch(e){(0,i.default)({metodo:a.tiposDeMetodos.DELETE,error:e,res:t})}}))},871:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deleteErrorHandler=void 0;const r=o(574);t.deleteErrorHandler=(e,t)=>e.includes("not found")?t.status(r.tiposDeEstados.NOT_FOUND).json({status:r.tiposDeEstados.NOT_FOUND.toString(),message:`Recurso no encontrado para eliminar: ${e}`}):t.status(r.tiposDeEstados.INTERNAL_SERVER_ERROR).json({status:r.tiposDeEstados.INTERNAL_SERVER_ERROR.toString(),message:`Error en ${r.tiposDeMetodos.DELETE}: ${e}`})},567:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(574),s=o(547),n=o(385),i=o(890),a=o(469),u=o(871);t.default=({metodo:e,error:t,res:o})=>{const d=new Error(String(t)).message;switch(console.error(`[${r.tiposDeMetodos[e]}] -> ${d}`),e){case r.tiposDeMetodos.GET:return(0,s.getErrorHandler)(d,o);case r.tiposDeMetodos.POST:return(0,n.postErrorHandler)(d,o);case r.tiposDeMetodos.PUT:return(0,i.putErrorHandler)(d,o);case r.tiposDeMetodos.PATCH:return(0,a.patchErrorHandler)(d,o);case r.tiposDeMetodos.DELETE:return(0,u.deleteErrorHandler)(d,o);default:return o.status(r.tiposDeEstados.INTERNAL_SERVER_ERROR).json({status:r.tiposDeEstados.INTERNAL_SERVER_ERROR.toString(),message:`Error inesperado: ${d}`})}}},547:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorHandler=void 0;const r=o(574);t.getErrorHandler=(e,t)=>e.includes("not found")?t.status(r.tiposDeEstados.NOT_FOUND).json({status:r.tiposDeEstados.NOT_FOUND.toString(),message:`Recurso no encontrado: ${e}`}):t.status(r.tiposDeEstados.INTERNAL_SERVER_ERROR).json({status:r.tiposDeEstados.INTERNAL_SERVER_ERROR.toString(),message:`Error en ${r.tiposDeMetodos.GET}: ${e}`})},469:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.patchErrorHandler=void 0;const r=o(574);t.patchErrorHandler=(e,t)=>e.includes("not allowed")?t.status(r.tiposDeEstados.FORBIDDEN).json({status:r.tiposDeEstados.FORBIDDEN.toString(),message:`Operación no permitida: ${e}`}):t.status(r.tiposDeEstados.INTERNAL_SERVER_ERROR).json({status:r.tiposDeEstados.INTERNAL_SERVER_ERROR.toString(),message:`Error en ${r.tiposDeMetodos.PATCH}: ${e}`})},385:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.postErrorHandler=void 0;const r=o(574);t.postErrorHandler=(e,t)=>e.includes("validation")?t.status(r.tiposDeEstados.BAD_REQUEST).json({status:r.tiposDeEstados.BAD_REQUEST.toString(),message:`Error de validación: ${e}`}):t.status(r.tiposDeEstados.INTERNAL_SERVER_ERROR).json({status:r.tiposDeEstados.INTERNAL_SERVER_ERROR.toString(),message:`Error en ${r.tiposDeMetodos.POST}: ${e}`})},890:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.putErrorHandler=void 0;const r=o(574);t.putErrorHandler=(e,t)=>e.includes("not found")?t.status(r.tiposDeEstados.NOT_FOUND).json({status:r.tiposDeEstados.NOT_FOUND.toString(),message:`No se pudo encontrar el recurso: ${e}`}):t.status(r.tiposDeEstados.INTERNAL_SERVER_ERROR).json({status:r.tiposDeEstados.INTERNAL_SERVER_ERROR.toString(),message:`Error en ${r.tiposDeMetodos.PUT}: ${e}`})},156:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var s=Object.getOwnPropertyDescriptor(t,o);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,s)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&r(t,e,o);return s(t,e),t},i=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,n){function i(e){try{u(r.next(e))}catch(e){n(e)}}function a(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const u=a(o(252)),d=n(o(436)),l=o(677),c=a(o(692)),f=a(o(896)),p=a(o(514)),E=a(o(818)),_=a(o(529)),v=a(o(680)),R=a(o(242)),D=a(o(259));E.default.config(),d.init({dsn:process.env.SENTRY_DSN,integrations:[(0,l.nodeProfilingIntegration)()],tracesSampleRate:1,profilesSampleRate:1});const m=(0,u.default)(),y=process.env.PORT||3e3;m.set("view engine","pug"),m.set("views","./src/templates");const h={key:f.default.readFileSync("./certs/key.pem","utf8"),cert:f.default.readFileSync("./certs/cert.pem","utf8")},g=c.default.createServer(h,m);d.setupExpressErrorHandler(m),(0,D.default)(m),m.use(u.default.json()),m.get("/hello",((e,t)=>{t.render("hello",{name:"lucas 2"})})),m.get("/",((e,t)=>{t.render("index",{name:"lucas 2"})})),m.use(_.default.initialize()),m.use("/health",R.default),m.use("/api",v.default),g.listen(y,(()=>i(void 0,void 0,void 0,(function*(){yield p.default.sync(),d.captureMessage("Hola lucas","info"),console.log(`[server]: Server levantado en: https://localhost:${y}`)}))))},188:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(31),n=r(o(514));class i extends s.Model{}i.init({id:{type:s.DataTypes.INTEGER.UNSIGNED,autoIncrement:!0,primaryKey:!0},level:{type:s.DataTypes.STRING,allowNull:!1},message:{type:s.DataTypes.STRING,allowNull:!1},timestamp:{type:s.DataTypes.DATE,allowNull:!1,defaultValue:s.DataTypes.NOW}},{sequelize:n.default,tableName:"logs"}),t.default=i},904:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=o(31),n=r(o(514));class i extends s.Model{}i.init({id:{type:s.DataTypes.INTEGER.UNSIGNED,autoIncrement:!0,primaryKey:!0},nombre:{type:new s.DataTypes.STRING(128),allowNull:!1},apellido:{type:new s.DataTypes.STRING(128),allowNull:!1}},{sequelize:n.default,tableName:"usuarios"}),t.default=i},242:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(o(252)),n=o(559),i=s.default.Router();i.get("/ping",((e,t)=>(0,n.obtenerPing)(e,t))),t.default=i},680:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(o(252)),n=o(409),i=s.default.Router();i.get("/usuarios",((e,t)=>(0,n.obtenerUsuarios)(e,t,"json"))),i.get("/usuarios-texto",((e,t)=>(0,n.obtenerUsuarios)(e,t,"texto"))),i.get("/usuarios-html",((e,t)=>(0,n.obtenerUsuarios)(e,t,"html"))),i.post("/usuarios",n.crearUsuario),i.put("/usuarios/:id",n.modificarUsuario),i.delete("/usuarios/:id",n.eliminarUsuario),t.default=i},574:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tiposDeEstados=t.tiposDeMetodos=void 0,t.tiposDeMetodos={GET:"GET",PUT:"PUT",POST:"POST",PATCH:"PATCH",DELETE:"DELETE"},t.tiposDeEstados={OK:200,CREATED:201,BAD_REQUEST:400,NOT_FOUND:404,FORBIDDEN:403,INTERNAL_SERVER_ERROR:500}},577:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var s=Object.getOwnPropertyDescriptor(t,o);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,s)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&r(t,e,o);return s(t,e),t},i=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,n){function i(e){try{u(r.next(e))}catch(e){n(e)}}function a(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.logErrorToSentryAndDb=t.logMessageToSentryAndDb=void 0;const u=n(o(436)),d=a(o(188));t.logMessageToSentryAndDb=(e,...t)=>i(void 0,[e,...t],void 0,(function*(e,t="info"){u.captureMessage(e,t),yield d.default.create({level:t,message:e,timestamp:new Date}),console.log(`[Log registrado]: ${e}`)})),t.logErrorToSentryAndDb=e=>i(void 0,void 0,void 0,(function*(){u.captureException(e),yield d.default.create({level:"error",message:e.message,timestamp:new Date}),console.error(`[Error registrado]: ${e.message}`)}))},436:e=>{e.exports=require("@sentry/node")},677:e=>{e.exports=require("@sentry/profiling-node")},818:e=>{e.exports=require("dotenv")},252:e=>{e.exports=require("express")},278:e=>{e.exports=require("passport")},714:e=>{e.exports=require("passport-jwt")},31:e=>{e.exports=require("sequelize")},450:e=>{e.exports=require("swagger-jsdoc")},320:e=>{e.exports=require("swagger-ui-express")},896:e=>{e.exports=require("fs")},692:e=>{e.exports=require("https")}},t={};!function o(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,o),n.exports}(156)})();
//# sourceMappingURL=bundle.js.map